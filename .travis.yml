sudo: false
language: go
go:
  - 1.6
  - tip
script:
  # Run go generate on all packages and check for changed files
  - go generate ./... && git status && git add --all . && [ ! -n "`git diff --staged HEAD`" ]
  # Run the test cases
  - ./.travis-test.bash
services:
  - postgresql
addons:
  # TODO: change this and plperl below to 9.5 when Travis CI supports it
  postgresql: 9.4
  apt:
    packages:
      # nodejs needed for go generate (lessc, etc.)
      - nodejs
      - postgresql-plperl-9.4
before_script:
  - psql -c 'create database travis_ci_test;' -U postgres
before_install:
  - go get -u golang.org/x/tools/cmd/cover github.com/mattn/goveralls
notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/11ed5656d9814f0bed7a
    on_success: change
    on_failure: always
    on_start: never
